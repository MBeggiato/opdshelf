{{define "layout.html"}}
<!DOCTYPE html>
<html lang="es" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>opdshelf</title>
  <link rel="icon" href="static/icon.png" type="image/png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
              950: '#172554',
            },
            dark: {
              bg: '#0f172a',
              card: '#1e293b',
              text: '#f8fafc',
              muted: '#94a3b8'
            }
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer base {
        body {
          @apply font-sans antialiased bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300;
        }
      }
      @layer components {
        .theme-card {
          @apply bg-white dark:bg-dark-card rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 transition-colors duration-300;
        }
        .btn-primary {
          @apply bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow-sm hover:shadow;
        }
        .btn-icon {
          @apply p-2 rounded-lg text-slate-500 hover:text-primary-600 hover:bg-primary-50 dark:text-slate-400 dark:hover:text-primary-400 dark:hover:bg-slate-800 transition-all duration-200;
        }
      }
    </style>
</head>

<body
  class="min-h-screen flex flex-col selection:bg-primary-200 selection:text-primary-900 dark:selection:bg-primary-900 dark:selection:text-primary-100">
  <header
    class="sticky top-0 z-50 backdrop-blur-md bg-white/80 dark:bg-dark-card/80 border-b border-slate-200 dark:border-slate-800 transition-colors duration-300">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="relative group">
          <div
            class="absolute -inset-1 bg-gradient-to-r from-primary-600 to-primary-400 rounded-full blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200">
          </div>
          <img src="/static/icon.png" alt="OPDShelf"
            class="relative h-10 w-10 transform transition-transform group-hover:scale-105" />
        </div>
        <h1
          class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-700 dark:from-white dark:to-slate-300">
          OPDShelf</h1>
      </div>

      <!-- Desktop Menu -->
      <div class="hidden sm:flex items-center space-x-2">
        <a href="/"
          class="px-4 py-2 font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">OPDS
          Feed</a>
        <a href="/admin"
          class="px-4 py-2 font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">Admin
          Panel</a>
        <div class="w-px h-6 bg-slate-200 dark:bg-slate-700 mx-2"></div>
        <button class="btn-icon" onclick="toggleTheme()" title="Toggle Theme">
          <i class="fas fa-moon dark:hidden"></i>
          <i class="fas fa-sun hidden dark:block"></i>
        </button>
      </div>

      <!-- Mobile Menu Button -->
      <button class="sm:hidden btn-icon" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu"
      class="hidden sm:hidden bg-white dark:bg-dark-card border-b border-slate-200 dark:border-slate-800 absolute w-full shadow-lg">
      <div class="px-4 py-3 flex flex-col space-y-2">
        <a href="/"
          class="p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-200 font-medium transition-colors">
          <i class="fas fa-rss w-6"></i> OPDS Feed
        </a>
        <a href="/admin"
          class="p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-200 font-medium transition-colors">
          <i class="fas fa-cog w-6"></i> Admin Panel
        </a>
        <button
          class="p-3 w-full text-left rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-700 dark:text-slate-200 font-medium transition-colors"
          onclick="toggleTheme()">
          <i class="fas fa-moon w-6 dark:hidden"></i>
          <i class="fas fa-sun w-6 hidden dark:block"></i>
          Toggle Theme
        </button>
      </div>
    </div>
  </header>

  <main class="flex-grow">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 animate-fade-in-up">
      {{template "content" .}}
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropZone = document.getElementById('dropZone');
      const fileInput = document.getElementById('book');
      const fileInfo = document.getElementById('fileInfo');

      // Prevenir comportamientos por defecto
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
        dropZone.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
        });
      });

      // Efecto visual al arrastrar
      dropZone.addEventListener('dragover', () => dropZone.classList.add('bg-primary/10'));
      dropZone.addEventListener('dragleave', () => dropZone.classList.remove('bg-primary/10'));

      // Manejar la soltar
      dropZone.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        if (files.length === 0) return;

        const file = files[0];
        const validTypes = ['application/pdf', 'application/epub+zip'];
        if (!validTypes.includes(file.type)) {
          fileInfo.classList.remove('hidden');
          fileInfo.textContent = 'Formato no válido. Solo EPUB o PDF.';
          return;
        }

        // Asignar al input y mostrar info
        fileInput.files = files;
        const sizeMB = (file.size / 1024 / 1024).toFixed(2);
        fileInfo.classList.remove('hidden');
        fileInfo.textContent = `Archivo seleccionado: ${file.name} (${sizeMB} MB)`;

        // Auto-submit the form
        const uploadForm = document.getElementById('uploadForm');
        if (uploadForm) uploadForm.submit();
      });

      // También al cambiar por clic
      fileInput.addEventListener('change', () => {
        const file = fileInput.files[0];
        if (!file) return;
        const sizeMB = (file.size / 1024 / 1024).toFixed(2);
        fileInfo.classList.remove('hidden');
        fileInfo.textContent = `Archivo seleccionado: ${file.name} (${sizeMB} MB)`;

        // Auto-submit the form
        const uploadForm = document.getElementById('uploadForm');
        if (uploadForm) uploadForm.submit();
      });
    });
  </script>

  <script>
    function toggleTheme() {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    }

    function toggleMobileMenu() {
      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.toggle('hidden');
    }

    (function () {
      const savedTheme = localStorage.getItem("theme");
      const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    })();
  </script>
</body>

</html>
{{end}}
